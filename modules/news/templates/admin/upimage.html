<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>插入/编辑图片</title>
	<script type="text/javascript" src="{?$jieqi_url?}/lib/html/tinymce/tiny_mce_popup.js"></script>
	<script type="text/javascript" src="{?$jieqi_url?}/lib/html/tinymce/utils/mctabs.js"></script>
	<script type="text/javascript" src="{?$jieqi_url?}/lib/html/tinymce/utils/form_utils.js"></script>
	<script type="text/javascript" src="{?$jieqi_url?}/lib/html/tinymce/themes/advanced/js/image.js"></script>
	<script language="javascript" type="text/javascript">
	 var allowExt = ['jpg', 'gif', 'bmp', 'png', 'jpeg'];
	 var preivew = function(file, container){
		 try{
			var pic =  new Picture(file, container);
		 }catch(e){
			 alert(e);
		 }
	 }
	 //缩略图类定义
     var Picture  = function(file, container){
		 var height	= 0, 
			 widht 	= 0, 
			 ext	= '',
			 size	= 0,
			 name   = '',
			 path  	=  '';
		 var self 	= this;
		 if(file){ 
		     name = file.value;
			 if (window.navigator.userAgent.indexOf("MSIE")>=1){ 
				 file.select(); 
				 path = document.selection.createRange().text; 
			 }else if(window.navigator.userAgent.indexOf("Firefox")>=1){ 
				 if(file.files){ 
					 path =  file.files.item(0).getAsDataURL(); 
				 }else{
					 path = file.value;
				 }
			 } 
		 }else{
			 throw "bad file";
		 } 


		 ext = name.substr(name.lastIndexOf("."), name.length);

		 if(container.tagName.toLowerCase() != 'img'){
			 throw "container is not a valid img label";
			 container.visibility = 'hidden';
		 }
		 container.src = path;
		 container.alt = name;
		 container.style.visibility = 'visible';
		 height = container.height;
		 widht  = container.widht;
		 size   = container.fileSize;


		 this.get = function(name){
			 return self[name];
		 }

		 this.isValid = function(){
			 if(allowExt.indexOf(self.ext) !== -1){
				 throw 'the ext is not allowed to upload';
				 return false;
			 }
		 }
	 }
</script>
	<base target="_self" />
</head>
<body id="image" style="display: none">

<form onsubmit="ImageDialog.update();return false;" action="#">
	<div class="tabs">
		<ul>
			<li id="general_tab" class="current"><span><a href="javascript:mcTabs.displayTab('general_tab','general_panel');" onmousedown="return false;">插入/编辑图片</a></span></li>
		</ul>
	</div>

	<div style="border:1px solid #919B9C; border-top:0px; clear:both; background:white;">
		<div id="general_panel">
     <table border="0" cellpadding="4" cellspacing="0">
          <tr>
            <td nowrap="nowrap"><label for="src">图片网址</label></td>
            <td><table border="0" cellspacing="0" cellpadding="0">
                <tr>
                  <td><input id="src" name="src" type="text" class="mceFocus" value="" style="width: 200px" onchange="ImageDialog.getImageData();" /></td>
                  <td id="srcbrowsercontainer">&nbsp;</td>
                </tr>
              </table></td>
          </tr>
		  <tr>
			<td><label for="image_list">图片列表</label></td>
			<td><select id="image_list" name="image_list" onchange="document.getElementById('src').value=this.options[this.selectedIndex].value;document.getElementById('alt').value=this.options[this.selectedIndex].text;"></select></td>
		  </tr>
          <tr>
            <td nowrap="nowrap"><label for="alt">图片说明</label></td>
            <td><input id="alt" name="alt" type="text" value="" style="width: 200px" /></td>
          </tr>
          <tr>
            <td nowrap="nowrap"><label for="align">对齐方式</label></td>
            <td><select id="align" name="align" onchange="ImageDialog.updateStyle();">
                <option value="">--未设置--</option>
                <option value="baseline">基准线</option>
                <option value="top">上方对齐</option>
                <option value="middle">居中对齐</option>
                <option value="bottom">底部对齐</option>
                <option value="text-top">文字上方</option>
                <option value="text-bottom">文字下方</option>
                <option value="left">靠左对齐</option>
                <option value="right">靠右对齐</option>
              </select>

			  &nbsp;&nbsp;&nbsp;&nbsp;<label for="width">尺寸</label>&nbsp;<input id="width" name="width" type="text" value="" size="3" maxlength="5" />
              x
              <input id="height" name="height" type="text" value="" size="3" maxlength="5" />
			</td>
          </tr>
          <tr>
            <td nowrap="nowrap"><label for="border">边框</label></td>
            <td><input id="border" name="border" type="text" value="" size="3" maxlength="3" onchange="ImageDialog.updateStyle();" />
			&nbsp;&nbsp;<label for="vspace">纵向间距</label>&nbsp;<input id="vspace" name="vspace" type="text" value="" size="3" maxlength="3" onchange="ImageDialog.updateStyle();" />
			&nbsp;&nbsp;<label for="hspace">水平间距</label>&nbsp;<input id="hspace" name="hspace" type="text" value="" size="3" maxlength="3" onchange="ImageDialog.updateStyle();" />
			</td>
          </tr>
        </table>
		</div>
	</div>

	<div class="mceActionPanel">
		<div style="float: left">
			<input type="submit" id="insert" name="insert" value="插入" />
		</div>

		<div style="float: right">
			<input type="button" id="cancel" name="cancel" value="取消" onclick="tinyMCEPopup.close();" />
		</div>
	</div>
</form>
<form enctype="multipart/form-data" name="frmupload" id="frmupload" method="post">
<div style="border:1px solid #919B9C; clear:both; background:white;padding:3px;">
  <div style="float: left">
  上传新图片：<br><br>
  <input name="imgfile" type="file" id="imgfile" onchange="preivew(this, document.getElementById('imgpreivew'));" size="20"><br><br>
  <input type="submit" name="picSubmit" id="picSubmit" value=" 上 传  ">
  <input type="hidden" name="action" value="upload">
  </div>
  <div style="float: right">
  <img id="imgpreivew"  style="visibility:hidden" height="100px" width="100px">
  </div>
  <div style="clear:both"></div>
</div>
</form>

<script language="javascript">
var imgsrc = "{?$imageurl?}";
if(imgsrc != ""){
	document.getElementById('src').value="{?$imageurl?}";
	ImageDialog.getImageData();
}
</script>
</body>
</html>
